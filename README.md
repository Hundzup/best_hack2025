# Локальный запуск без докера
```
pip install -r requirements.txt
cd .\hack_best\
uvicorn backend.main:app --reload --port 8000
```
# Запуск через докер
```
sudo docker build -t best_hack_image .
sudo docker run --rm --name bh -p 8000:8000 best_hack_image
```

# Геокодер Москвы

Этот проект представляет собой REST API для геокодирования адресов Москвы с использованием локальной базы данных. Алгоритм точно определяет координаты по текстовому описанию адреса.

## Основные компоненты системы

- **Бэкенд**: FastAPI-приложение, обрабатывающее запросы
- **База данных**: SQLite-база с адресами Москвы (`addresses.db`)
- **Фронтенд**: Простой HTML-интерфейс для ввода адресов

## Алгоритм геокодирования

### 1. Нормализация входных данных
- Текст приводится к нижнему регистру
- Удаляются специальные символы и лишние пробелы
- Удаляется явное упоминание "Москва" из адреса

### 2. Извлечение названия улицы
Алгоритм использует следующую последовательность:

1. **Поиск по типам улиц** (список FIAS):
   - Проверяются официальные сокращения (ул., просп., б-р и т.д.)
   - Найденный тип нормализуется (например, "пр-кт" → "проспект")
   - Выделяется название улицы после типа

2. **Резервные шаблоны**:
   - Поиск по шаблонам "ул. Название" или "Название улица"
   - Обработка специальных случаев (например, "улица 1905 года")

3. **Запасной вариант**:
   - Используется текст до первой запятой

### 3. Разбор компонентов здания
Алгоритм извлекает:
- Номер дома (по шаблонам "д. 12", "дом 12")
- Номер корпуса (по шаблонам "к3", "корп.3")
- Номер строения (по шаблонам "с4", "строение 4")
- Владение (по шаблонам "вл5", "владение 5")

Компоненты объединяются в единый строковый идентификатор для поиска.

### 4. Поиск улицы в базе данных
Для сопоставления используется комбинация метрик:

| Метрика | Вес | Особенности |
|---------|-----|-------------|
| Jaro-Winkler | 50% | Учитывает порядок символов, хорошо работает с опечатками |
| TF-IDF + Cosine | 33% | Анализирует буквенную структуру на уровне n-грамм |
| Levenshtein | 17% | Учитывает минимальное количество правок для совпадения |

Дополнительные правила:
- +10% к баллу при совпадении типа улицы
- Порог отсечения: 0.45 (только надежные совпадения)
- Проверка на ключевые улицы (Родионова, Кутузовский и др.) с приоритетом

### 5. Поиск здания на улице
- Сначала проверяется точное совпадение номера
- При несовпадении используется комбинация:
  - Levenshtein (60% веса)
  - Jaro-Winkler (40% веса)
- Порог отсечения: 0.7 для номеров зданий
- Если совпадений нет, возвращается первое здание на улице

### 6. Формирование результата
- Возвращается координата с максимальным совокупным баллом
- Балл точности рассчитывается как среднее между баллами улицы и здания
- Структурированный ответ содержит все извлеченные компоненты адреса

## Пример работы

**Входной адрес**:  
`г. Москва, ул. Ленина, д. 15, к. 2`

**Процесс обработки**:
1. Удаляется "г. Москва"
2. Выделяется улица "Ленина" (тип "улица")
3. Извлекается номер дома "15", корпус "2"
4. Ищется совпадение с улицей "улица Ленина" в базе
5. На найденной улице ищется дом с номером "15к2"
6. Возвращаются координаты с баллом точности

## Особенности реализации
- Оптимизирована для московских адресов
- Устойчив к опечаткам и нестандартному формату ввода
- Использует локальную базу данных (не требует интернет-соединения)
- Возвращает структурированные данные с оценкой точности
- Поддерживает основные типы улиц и сокращения из классификатора ФИАС

## Точность
Алгоритм обеспечивает высокую точность работы

Результат всегда содержит оценку точности (score), позволяющую определить надежность найденных координат.
